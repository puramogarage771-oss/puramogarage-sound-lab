<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PURAMO GARAGE | SOUND LAB - Keyboard</title>
<style>
:root{
  --bg:#000;
  --neon:#00ffcc;
  --panel:#020404;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--neon);
  font-family: monospace;
  padding:20px;
}
h1{font-size:22px;margin:0 0 6px;}
.small{opacity:.85;font-size:13px;margin:0 0 12px;}
.panel{
  border:1px solid var(--neon);
  padding:14px;
  margin:14px 0;
  background: rgba(0,0,0,.35);
}
button{
  background:transparent;
  color:var(--neon);
  border:1px solid var(--neon);
  padding:8px 12px;
  cursor:pointer;
  margin-right:6px;
}
button:hover{background:var(--neon);color:#000;}
.readout{
  font-size:16px;
  margin-top:8px;
  line-height:1.6;
}
.code{
  margin-top:8px;
  border:1px solid var(--neon);
  background:var(--panel);
  padding:10px;
  white-space:pre;
  font-size:14px;
}

/* ===== Keyboard ===== */
.keyboard-wrap{
  width:min(980px, 100%);
  position:relative;
  user-select:none;
  touch-action:none;
  margin-top:10px;
}
.white-keys{
  display:grid;
  grid-template-columns: repeat(8, 1fr);
  gap:6px;
}
.white{
  height:220px;
  border:1px solid var(--neon);
  background:#fff;
  color:#000;
  border-radius:8px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-bottom:8px;
  font-size:13px;
  cursor:pointer;
}
.white.active{
  background:#dff;
  outline:2px solid var(--neon);
}
.black-keys{
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:150px;
}
.black{
  position:absolute;
  width:11%;
  height:150px;
  background:#111;
  border:1px solid var(--neon);
  border-radius:8px;
  color:var(--neon);
  display:flex;
  align-items:flex-end;
  justify-content:center;
  padding-bottom:8px;
  font-size:11px;
  cursor:pointer;
}
.black.active{
  background:#033;
  outline:2px solid var(--neon);
}

/* é»’éµä½ç½®ï¼ˆç™½éµ8æšæƒ³å®šï¼‰ */
.b-cs{ left:7.5%; }
.b-ds{ left:19.5%; }
.b-fs{ left:43.5%; }
.b-gs{ left:55.5%; }
.b-as{ left:67.5%; }
</style>
</head>

<body>

<h1>ğŸ¹ PURAMO GARAGE â€“ SOUND LAB</h1>
<p class="small">
â–¶ éŸ³ã‚’æœ‰åŠ¹åŒ– ã‚’1å›ã‚¯ãƒªãƒƒã‚¯ â†’ éµç›¤ã‚’æŠ¼ã™ï¼ˆã‚¯ãƒªãƒƒã‚¯/ã‚¿ãƒƒãƒ—é•·æŠ¼ã—ï¼‰
</p>

<div class="panel">
  <button id="unlockBtn">â–¶ éŸ³ã‚’æœ‰åŠ¹åŒ–</button>
  <button id="stopBtn">â–  å…¨åœæ­¢</button>
  <button id="copyBtn">COPY tone()</button>

  <div class="readout" id="readout">
    Note: - / Hz: - / half_period: -
  </div>

  <div class="code" id="codeBox">tone(1908, 300);</div>

  <p class="small">
    half_period(us) = 1,000,000 / (Hz Ã— 2)ï¼ˆPICå®Ÿæ©Ÿã¯ -10ã€œ15%è£œæ­£ãŒç›®å®‰ï¼‰
  </p>
</div>

<!-- ===== Keyboard C4â€“C5 ===== -->
<div class="panel">
  <h2 style="font-size:16px;margin:0 0 6px;">1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ç›®ï¼ˆC4â€“C5ï¼‰</h2>
  <div class="keyboard-wrap">
    <div class="white-keys" id="whiteC4"></div>
    <div class="black-keys">
      <div class="black b-cs" data-note="C#4">ãƒ‰â™¯</div>
      <div class="black b-ds" data-note="D#4">ãƒ¬â™¯</div>
      <div class="black b-fs" data-note="F#4">ãƒ•ã‚¡â™¯</div>
      <div class="black b-gs" data-note="G#4">ã‚½â™¯</div>
      <div class="black b-as" data-note="A#4">ãƒ©â™¯</div>
    </div>
  </div>
</div>

<!-- ===== Keyboard C5â€“C6 ===== -->
<div class="panel">
  <h2 style="font-size:16px;margin:0 0 6px;">2ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ç›®ï¼ˆC5â€“C6ï¼‰</h2>
  <div class="keyboard-wrap">
    <div class="white-keys" id="whiteC5"></div>
    <div class="black-keys">
      <div class="black b-cs" data-note="C#5">ãƒ‰â™¯</div>
      <div class="black b-ds" data-note="D#5">ãƒ¬â™¯</div>
      <div class="black b-fs" data-note="F#5">ãƒ•ã‚¡â™¯</div>
      <div class="black b-gs" data-note="G#5">ã‚½â™¯</div>
      <div class="black b-as" data-note="A#5">ãƒ©â™¯</div>
    </div>
  </div>
</div>

<script>
/* ===== Web Audio ===== */
let ctx=null, masterGain=null;
const active=new Map();

const noteHz={
  C4:261.63,"C#4":277.18,D4:293.66,"D#4":311.13,E4:329.63,
  F4:349.23,"F#4":369.99,G4:392.00,"G#4":415.30,A4:440.00,"A#4":466.16,B4:493.88,
  C5:523.25,"C#5":554.37,D5:587.33,"D#5":622.25,E5:659.26,
  F5:698.46,"F#5":739.99,G5:783.99,"G#5":830.61,A5:880.00,"A#5":932.33,B5:987.77,
  C6:1046.50
};

const solfege={
  C:"ãƒ‰",D:"ãƒ¬",E:"ãƒŸ",F:"ãƒ•ã‚¡",G:"ã‚½",A:"ãƒ©",B:"ã‚·"
};

function halfPeriod(hz){return Math.round(1000000/(hz*2));}

const readout=document.getElementById("readout");
const codeBox=document.getElementById("codeBox");

async function ensureAudio(){
  if(!ctx){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
    masterGain=ctx.createGain();
    masterGain.gain.value=0.25;
    masterGain.connect(ctx.destination);
  }
  await ctx.resume();
}

function startNote(note,key){
  if(active.has(key)) return;
  const hz=noteHz[note];
  const osc=ctx.createOscillator();
  const g=ctx.createGain();
  osc.type="square";
  osc.frequency.value=hz;
  g.gain.value=0;
  const t=ctx.currentTime;
  g.gain.linearRampToValueAtTime(1,t+0.005);
  osc.connect(g); g.connect(masterGain); osc.start();
  active.set(key,{osc,g});
  const base=note[0]()

