<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PURAMO GARAGE | SOUND LAB - Keyboard</title>
<style>
body{
  background:#000; color:#00ffcc; font-family:monospace; padding:20px;
}
.panel{border:1px solid #00ffcc; padding:14px; margin:14px 0;}
button{
  background:#000; color:#00ffcc; border:1px solid #00ffcc;
  padding:6px 12px; cursor:pointer; margin-right:6px;
}
button:hover{background:#00ffcc;color:#000;}
.readout{margin-top:8px;font-size:15px;}
.code{margin-top:8px;border:1px solid #00ffcc;background:#020404;
      padding:8px;white-space:pre;}
.keyboard{display:grid;grid-template-columns:repeat(8,1fr);gap:6px;}
.key{
  height:200px;background:#fff;color:#000;border-radius:6px;
  display:flex;align-items:flex-end;justify-content:center;
  padding-bottom:8px;font-size:14px;cursor:pointer;
}
.key.active{background:#dff;outline:2px solid #00ffcc;}
</style>
</head>
<body>

<h1>ğŸ¹ SOUND LABï¼ˆãƒ‰ãƒ¬ãƒŸç¢ºèªç”¨ï¼‰</h1>

<div class="panel">
  <button id="unlock">â–¶ éŸ³ã‚’æœ‰åŠ¹åŒ–</button>
  <button id="stop">â–  å…¨åœæ­¢</button>
  <div class="readout" id="readout">Audio: locked</div>
  <div class="code" id="code">tone(1908, 300);</div>
</div>

<div class="panel">
  <h3>C4 â†’ C5ï¼ˆ1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ï¼‰</h3>
  <div class="keyboard" id="kb1"></div>
</div>

<div class="panel">
  <h3>C5 â†’ C6ï¼ˆ1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ï¼‰</h3>
  <div class="keyboard" id="kb2"></div>
</div>

<script>
let ctx=null, gain=null;
const active={};

const notes=[
  {n:"C4",s:"ãƒ‰",hz:261.63},
  {n:"D4",s:"ãƒ¬",hz:293.66},
  {n:"E4",s:"ãƒŸ",hz:329.63},
  {n:"F4",s:"ãƒ•ã‚¡",hz:349.23},
  {n:"G4",s:"ã‚½",hz:392.00},
  {n:"A4",s:"ãƒ©",hz:440.00},
  {n:"B4",s:"ã‚·",hz:493.88},
  {n:"C5",s:"ãƒ‰",hz:523.25},
];

const notes2=[
  {n:"C5",s:"ãƒ‰",hz:523.25},
  {n:"D5",s:"ãƒ¬",hz:587.33},
  {n:"E5",s:"ãƒŸ",hz:659.26},
  {n:"F5",s:"ãƒ•ã‚¡",hz:698.46},
  {n:"G5",s:"ã‚½",hz:783.99},
  {n:"A5",s:"ãƒ©",hz:880.00},
  {n:"B5",s:"ã‚·",hz:987.77},
  {n:"C6",s:"ãƒ‰",hz:1046.5},
];

function half(hz){return Math.round(1000000/(hz*2));}

async function ensure(){
  if(!ctx){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
    gain=ctx.createGain(); gain.gain.value=0.25; gain.connect(ctx.destination);
  }
  await ctx.resume();
}

function start(note){
  if(active[note.n]) return;
  const o=ctx.createOscillator();
  o.type="square"; o.frequency.value=note.hz;
  o.connect(gain); o.start();
  active[note.n]=o;
  document.getElementById("readout").textContent=
    `${note.s} (${note.n}) ${note.hz.toFixed(1)}Hz / half ${half(note.hz)}us`;
  document.getElementById("code").textContent=
    `tone(${half(note.hz)}, 300);`;
}

function stop(note){
  const o=active[note.n];
  if(!o) return;
  o.stop(); delete active[note.n];
}

function build(id,arr){
  const kb=document.getElementById(id);
  arr.forEach(note=>{
    const d=document.createElement("div");
    d.className="key"; d.textContent=note.s;
    d.onpointerdown=async e=>{
      await ensure(); start(note); d.classList.add("active");
    };
    d.onpointerup=()=>{stop(note); d.classList.remove("active");};
    d.onpointerleave=()=>{stop(note); d.classList.remove("active");};
    kb.appendChild(d);
  });
}

build("kb1",notes);
build("kb2",notes2);

document.getElementById("unlock").onclick=ensure;
document.getElementById("stop").onclick=()=>{
  Object.keys(active).forEach(k=>{active[k].stop();delete active[k];});
};
</script>

</body>
</html>

