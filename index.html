<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>PURAMO GARAGE | SOUND LAB</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
  background:#000;
  color:#00ffcc;
  font-family: monospace;
  padding:20px;
}
h1{font-size:22px;}
.panel{
  border:1px solid #00ffcc;
  padding:16px;
  margin-bottom:20px;
}
button{
  background:#000;
  color:#00ffcc;
  border:1px solid #00ffcc;
  padding:8px 14px;
  margin:4px;
  cursor:pointer;
}
button:hover{
  background:#00ffcc;
  color:#000;
}
input[type=range]{
  width:100%;
}
.value{
  font-size:18px;
  margin-top:8px;
}
.code{
  background:#020404;
  border:1px solid #00ffcc;
  padding:12px;
  margin-top:10px;
  white-space:pre;
  font-size:14px;
}
.small{
  font-size:13px;
  opacity:0.8;
}
</style>
</head>

<body>

<h1>ğŸ”Š PURAMO GARAGE â€“ SOUND LAB</h1>
<p class="small">
â–¶ å†ç”Ÿ ã‚’1å›ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‹ã‚‰æ“ä½œã—ã¦ãã ã•ã„
</p>

<div class="panel">
  <h2>â‘  å‘¨æ³¢æ•°ãƒ†ã‚¹ãƒˆ</h2>

  <input type="range" id="freq" min="150" max="1000" value="262" step="1">

  <div class="value">
    å‘¨æ³¢æ•°: <span id="freqVal">262</span> Hz
  </div>
  <div class="value">
    PIC half_period: <span id="halfVal">1908</span> us
  </div>

  <button onclick="start()">â–¶ å†ç”Ÿ</button>
  <button onclick="stop()">â–  åœæ­¢</button>

  <div class="code" id="picCode">
tone(1908, 300);
  </div>
</div>

<div class="panel">
  <h2>â‘¡ éŸ³éš</h2>
  <button onclick="setFreq(262)">ãƒ‰ C4</button>
  <button onclick="setFreq(294)">ãƒ¬ D4</button>
  <button onclick="setFreq(330)">ãƒŸ E4</button>
  <button onclick="setFreq(349)">ãƒ•ã‚¡ F4</button>
  <button onclick="setFreq(392)">ã‚½ G4</button>
  <button onclick="setFreq(440)">ãƒ© A4</button>
  <button onclick="setFreq(494)">ã‚· B4</button>
  <button onclick="setFreq(523)">ãƒ‰ C5</button>
</div>

<p class="small">
half_period = 1,000,000 / (Hz Ã— 2)<br>
â€» PICå®Ÿæ©Ÿã§ã¯ -10ã€œ15% è£œæ­£ãŒç›®å®‰
</p>

<script>
let ctx = null;
let osc = null;

const freqSlider = document.getElementById("freq");
const freqVal = document.getElementById("freqVal");
const halfVal = document.getElementById("halfVal");
const picCode = document.getElementById("picCode");

function update(){
  const f = Number(freqSlider.value);
  const half = Math.round(1000000 / (f * 2));

  freqVal.textContent = f;
  halfVal.textContent = half;
  picCode.textContent = `tone(${half}, 300);`;

  if(osc){
    osc.frequency.value = f;
  }
}

async function start(){
  if(!ctx){
    ctx = new (window.AudioContext || window.webkitAudioContext)();
  }
  await ctx.resume();   // â† ã“ã‚ŒãŒç„¡ã„ã¨é³´ã‚‰ãªã„

  if(!osc){
    osc = ctx.createOscillator();
    osc.type = "square";      // PICã«è¿‘ã„éŸ³
    osc.frequency.value = freqSlider.value;
    osc.connect(ctx.destination);
    osc.start();
  }
}

function stop(){
  if(osc){
    osc.stop();
    osc.disconnect();
    osc = null;
  }
  if(ctx){
    ctx.close();
    ctx = null;
  }
}

function setFreq(f){
  freqSlider.value = f;
  update();
}

freqSlider.addEventListener("input", update);
update();
</script>

</body>
</html>

