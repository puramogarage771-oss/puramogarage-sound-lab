<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>PURAMO GARAGE | Phrase Player</title>
<style>
  body{background:#000;color:#00ffcc;font-family:monospace;padding:20px;}
  .panel{border:1px solid #00ffcc;padding:14px;margin:14px 0;}
  button{background:#000;color:#00ffcc;border:1px solid #00ffcc;padding:8px 14px;cursor:pointer;}
  button:hover{background:#00ffcc;color:#000;}
  .small{opacity:.85;font-size:13px;}
  .code{margin-top:10px;border:1px solid #00ffcc;background:#020404;padding:10px;white-space:pre;}
</style>
</head>
<body>

<h1>ğŸ¼ Phrase Player</h1>
<p class="small">æœ€åˆã«ã€Œâ–¶ éŸ³ã‚’æœ‰åŠ¹åŒ–ã€ã‚’æŠ¼ã—ã¦ã‹ã‚‰å†ç”Ÿã€‚</p>

<div class="panel">
  <button id="unlock">â–¶ éŸ³ã‚’æœ‰åŠ¹åŒ–</button>
  <button id="play">â–¶ ãƒ•ãƒ¬ãƒ¼ã‚ºå†ç”Ÿ</button>
  <button id="stop">â–  åœæ­¢</button>

  <div class="code" id="disp">
ãƒŸ ãƒ© ãƒ‰ ã‚· ãƒ© ãƒ‰ ãƒ© ã‚· ãƒ© ãƒ•ã‚¡ ã‚½ ãƒŸãƒ¼ãƒ¼ãƒ¼
  </div>
</div>

<script>
let ctx=null;
let master=null;
let timers=[];

async function ensure(){
  if(!ctx){
    ctx=new (window.AudioContext||window.webkitAudioContext)();
    master=ctx.createGain();
    master.gain.value=0.25;
    master.connect(ctx.destination);
  }
  await ctx.resume();
}

function stopAll(){
  timers.forEach(t=>clearTimeout(t));
  timers=[];
}

function playTone(hz, ms){
  const osc=ctx.createOscillator();
  const g=ctx.createGain();
  osc.type="square";
  osc.frequency.value=hz;

  // ã‚¯ãƒªãƒƒã‚¯è»½æ¸›ï¼ˆçŸ­ã„ãƒ•ã‚§ãƒ¼ãƒ‰ï¼‰
  const t0=ctx.currentTime;
  g.gain.setValueAtTime(0.0, t0);
  g.gain.linearRampToValueAtTime(1.0, t0 + 0.005);
  g.gain.linearRampToValueAtTime(0.0, t0 + (ms/1000) - 0.01);

  osc.connect(g);
  g.connect(master);
  osc.start();
  osc.stop(t0 + ms/1000);
}

// ===== éŸ³åâ†’å‘¨æ³¢æ•°ï¼ˆCãƒ¡ã‚¸ãƒ£ãƒ¼æƒ³å®š / 1ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–ï¼‰ =====
const HZ = {
  "ãƒ‰": 523.25,  // C5
  "ãƒ¬": 587.33,  // D5
  "ãƒŸ": 659.26,  // E5
  "ãƒ•ã‚¡": 698.46,// F5
  "ã‚½": 783.99,  // G5
  "ãƒ©": 880.00,  // A5
  "ã‚·": 987.77   // B5
};

// ãƒ•ãƒ¬ãƒ¼ã‚ºï¼šãƒŸ ãƒ© ãƒ‰ ã‚· ãƒ© ãƒ‰ ãƒ© ã‚· ãƒ© ãƒ•ã‚¡ ã‚½ ãƒŸãƒ¼ãƒ¼ãƒ¼
// æœ€å¾Œã®ãƒŸã¯ä¼¸ã°ã™
const phrase = [
  ["ãƒŸ", 260], ["ãƒ©", 260], ["ãƒ‰", 260], ["ã‚·", 260],
  ["ãƒ©", 260], ["ãƒ‰", 260], ["ãƒ©", 260], ["ã‚·", 260],
  ["ãƒ©", 260], ["ãƒ•ã‚¡", 260], ["ã‚½", 260],
  ["ãƒŸ", 900]  // ãƒŸãƒ¼ãƒ¼ãƒ¼
];

const GAP = 60; // ä¼‘ç¬¦ï¼ˆmsï¼‰

async function playPhrase(){
  await ensure();
  stopAll();

  let time = 0;
  for(const [name, dur] of phrase){
    const hz = HZ[name];
    timers.push(setTimeout(()=>playTone(hz, dur), time));
    time += dur + GAP;
  }
}

document.getElementById("unlock").onclick=ensure;
document.getElementById("play").onclick=playPhrase;
document.getElementById("stop").onclick=stopAll;
</script>

</body>
</html>

